#--------------------------------------------
# ◇Chapter18　本管理アプリ：モデル記述コードのチェック（tinker）・テストデータの自動生成（Seeder）を行う
#--------------------------------------------



#**************************************************
# Tinker準備
#**************************************************
#--------------------------------------------
#MySQLの起動・再起動（動作していない場合のため）
# 注意）AmazonLinux2 ではこのコマンドは必要ありません！
sudo service mysqld restart

#cmsフォルダに移動
cd cms
#--------------------------------------------



#**************************************************
# 1. Tinker開始
#**************************************************
#--------------------------------------------

 php artisan tinker

#[END]--------------------------------------------



#**************************************************
# ２. booksテーブル全データを取得する
#**************************************************
#--------------------------------------------

 $all = App\Book::all();

#[END]--------------------------------------------



#**************************************************
#３．booksテーブルのitem_number=1のデータをGET（取得）
#**************************************************
#--------------------------------------------

#item_numberカラムに「1」のテストデータが入っていないと表示されません
$item_number1 = App\Book::where('item_number',1)->get();
 
#[END]--------------------------------------------



#**************************************************
#４．booksテーブルのitem_amount=1000のデータをGET（取得）
#**************************************************
#--------------------------------------------

#item_amountカラムに「1000」のテストデータが入っていないと表示されません
$item_amount1000 = App\Book::where('item_amount',1000)->get();
 
#[END]--------------------------------------------



#**************************************************
#５．booksテーブルのitem_number=1でidが「最新順で10件」のみGET(取得）
#**************************************************
#--------------------------------------------

#item_numberカラムに「1」のテストデータが入っていないと表示されません
$get = App\Book::where('item_number', 1)->orderBy('id', 'desc')->take(10)->get();
 
#[END]--------------------------------------------



#**************************************************
#６．booksテーブルのid =1のみ取得
#**************************************************
#--------------------------------------------

#idカラムに「1」のテストデータが入っていないと表示されません
$get = App\Book::find(1);
 
#[END]--------------------------------------------



#**************************************************
#７．booksテーブルのid =1のみ取得
#**************************************************
#--------------------------------------------

#idカラムに「1」のテストデータが入っていないと表示されません
$get= App\Book::where('id', 1)->first();
 
#[END]--------------------------------------------



#**************************************************
#８．Tinker終了
#**************************************************
#--------------------------------------------

exit
 
#[END]--------------------------------------------






#**************************************************
# Seeder準備
#**************************************************
#--------------------------------------------

#MySQLの起動・再起動（動作していない場合のため）
# 注意）AmazonLinux2 ではこのコマンドは必要ありません！
sudo service mysqld restart

#cmsフォルダに移動
cd cms

#[END]--------------------------------------------



#**************************************************
# 1. Seederファイルを作る
#**************************************************
#--------------------------------------------

 php artisan make:seeder BooksTableSeeder

#[END]--------------------------------------------



#**************************************************
# ２. public function run(){.....}の中に追加（リスト18.2、18.3、18.4）
#**************************************************
#--------------------------------------------

      $faker = Faker\Factory::create('ja_JP');
      for($i = 0; $i < 10; $i++) {
          App\Book::create([
              'item_name' => $faker->word(), //文字列
               'user_id' => $faker->numberBetween(1, 2), //1〜2
               'item_number' => $faker->numberBetween(1, 999), //1〜999
               'item_amount' => $faker->numberBetween(100, 5000), //100〜5000
               'item_img'=> $faker->image("./public/upload", 300, 300, 'cats', false),
               'published' => $faker->dateTime('now'), //現在までYmdHis
               'created_at' => $faker->dateTime('now'), //現在までYmdHis
               'updated_at' => $faker->dateTime('now'), //現在までYmdHis
          ]);
       }

#[END]--------------------------------------------



#**************************************************
# ３. テストデータを生成
#**************************************************
#--------------------------------------------

php artisan db:seed --class="BooksTableSeeder"

#[END]--------------------------------------------



#**************************************************
# ４. テストデータ登録確認
#**************************************************
#--------------------------------------------

#MySQLに入ります
mysql -u root -p

#パスワード
root

#データベース選択
use c9;

#booksテーブルのデータを全て表示
SELECT * FROM books;

#MySQLを抜けます
exit;

#[END]--------------------------------------------

